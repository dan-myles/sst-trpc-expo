{"dependencies":[{"name":"@trpc/server/observable","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":53,"index":53}}],"key":"I122979nMYhHcuaUZWanjRGzbec="}},{"name":"../internals/inputWithTrackedEventId.mjs","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":2,"column":0,"index":54},"end":{"line":2,"column":83,"index":137}}],"key":"XH14U48Ui7KRO8lXIMaXunVmw4c="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.retryLink = retryLink;\n  var _observable = require(_dependencyMap[0], \"@trpc/server/observable\");\n  var _inputWithTrackedEventId = require(_dependencyMap[1], \"../internals/inputWithTrackedEventId.mjs\");\n  /* istanbul ignore file -- @preserve */ // We're not actually exporting this link\n  /**\n   * @see https://trpc.io/docs/v11/client/links/retryLink\n   */function retryLink(opts) {\n    // initialized config\n    return () => {\n      // initialized in app\n      return callOpts => {\n        // initialized for request\n        return (0, _observable.observable)(observer => {\n          var next$;\n          var lastEventId = undefined;\n          attempt(1);\n          function opWithLastEventId() {\n            var op = callOpts.op;\n            if (!lastEventId) {\n              return op;\n            }\n            return {\n              ...op,\n              input: (0, _inputWithTrackedEventId.inputWithTrackedEventId)(op.input, lastEventId)\n            };\n          }\n          function attempt(attempts) {\n            var op = opWithLastEventId();\n            next$ = callOpts.next(op).subscribe({\n              error(error) {\n                var shouldRetry = opts.retry({\n                  op,\n                  attempts,\n                  error\n                });\n                if (shouldRetry) {\n                  attempt(attempts + 1);\n                } else {\n                  observer.error(error);\n                }\n              },\n              next(envelope) {\n                //\n                if ((!envelope.result.type || envelope.result.type === 'data') && envelope.result.id) {\n                  //\n                  lastEventId = envelope.result.id;\n                }\n                observer.next(envelope);\n              },\n              complete() {\n                observer.complete();\n              }\n            });\n          }\n          return () => {\n            next$.unsubscribe();\n          };\n        });\n      };\n    };\n  }\n});","lineCount":66,"map":[[6,2,1,0],[6,6,1,0,"_observable"],[6,17,1,0],[6,20,1,0,"require"],[6,27,1,0],[6,28,1,0,"_dependencyMap"],[6,42,1,0],[7,2,2,0],[7,6,2,0,"_inputWithTrackedEventId"],[7,30,2,0],[7,33,2,0,"require"],[7,40,2,0],[7,41,2,0,"_dependencyMap"],[7,55,2,0],[8,2,4,0],[8,42,4,40],[9,2,5,0],[10,0,6,0],[11,0,7,0],[11,5,7,4],[11,14,7,13,"retryLink"],[11,23,7,22,"retryLink"],[11,24,7,23,"opts"],[11,28,7,27],[11,30,7,29],[12,4,8,4],[13,4,9,4],[13,11,9,11],[13,17,9,15],[14,6,10,8],[15,6,11,8],[15,13,11,16,"callOpts"],[15,21,11,24],[15,25,11,27],[16,8,12,12],[17,8,13,12],[17,15,13,19],[17,19,13,19,"observable"],[17,41,13,29],[17,43,13,31,"observer"],[17,51,13,39],[17,55,13,42],[18,10,14,16],[18,14,14,20,"next$"],[18,19,14,25],[19,10,15,16],[19,14,15,20,"lastEventId"],[19,25,15,31],[19,28,15,34,"undefined"],[19,37,15,43],[20,10,16,16,"attempt"],[20,17,16,23],[20,18,16,24],[20,19,16,25],[20,20,16,26],[21,10,17,16],[21,19,17,25,"opWithLastEventId"],[21,36,17,42,"opWithLastEventId"],[21,37,17,42],[21,39,17,45],[22,12,18,20],[22,16,18,26,"op"],[22,18,18,28],[22,21,18,31,"callOpts"],[22,29,18,39],[22,30,18,40,"op"],[22,32,18,42],[23,12,19,20],[23,16,19,24],[23,17,19,25,"lastEventId"],[23,28,19,36],[23,30,19,38],[24,14,20,24],[24,21,20,31,"op"],[24,23,20,33],[25,12,21,20],[26,12,22,20],[26,19,22,27],[27,14,23,24],[27,17,23,27,"op"],[27,19,23,29],[28,14,24,24,"input"],[28,19,24,29],[28,21,24,31],[28,25,24,31,"inputWithTrackedEventId"],[28,73,24,54],[28,75,24,55,"op"],[28,77,24,57],[28,78,24,58,"input"],[28,83,24,63],[28,85,24,65,"lastEventId"],[28,96,24,76],[29,12,25,20],[29,13,25,21],[30,10,26,16],[31,10,27,16],[31,19,27,25,"attempt"],[31,26,27,32,"attempt"],[31,27,27,33,"attempts"],[31,35,27,41],[31,37,27,43],[32,12,28,20],[32,16,28,26,"op"],[32,18,28,28],[32,21,28,31,"opWithLastEventId"],[32,38,28,48],[32,39,28,49],[32,40,28,50],[33,12,29,20,"next$"],[33,17,29,25],[33,20,29,28,"callOpts"],[33,28,29,36],[33,29,29,37,"next"],[33,33,29,41],[33,34,29,42,"op"],[33,36,29,44],[33,37,29,45],[33,38,29,46,"subscribe"],[33,47,29,55],[33,48,29,56],[34,14,30,24,"error"],[34,19,30,29,"error"],[34,20,30,31,"error"],[34,25,30,36],[34,27,30,38],[35,16,31,28],[35,20,31,34,"shouldRetry"],[35,31,31,45],[35,34,31,48,"opts"],[35,38,31,52],[35,39,31,53,"retry"],[35,44,31,58],[35,45,31,59],[36,18,32,32,"op"],[36,20,32,34],[37,18,33,32,"attempts"],[37,26,33,40],[38,18,34,32,"error"],[39,16,35,28],[39,17,35,29],[39,18,35,30],[40,16,36,28],[40,20,36,32,"shouldRetry"],[40,31,36,43],[40,33,36,45],[41,18,37,32,"attempt"],[41,25,37,39],[41,26,37,40,"attempts"],[41,34,37,48],[41,37,37,51],[41,38,37,52],[41,39,37,53],[42,16,38,28],[42,17,38,29],[42,23,38,35],[43,18,39,32,"observer"],[43,26,39,40],[43,27,39,41,"error"],[43,32,39,46],[43,33,39,47,"error"],[43,38,39,52],[43,39,39,53],[44,16,40,28],[45,14,41,24],[45,15,41,25],[46,14,42,24,"next"],[46,18,42,28,"next"],[46,19,42,30,"envelope"],[46,27,42,38],[46,29,42,40],[47,16,43,28],[48,16,44,28],[48,20,44,32],[48,21,44,33],[48,22,44,34,"envelope"],[48,30,44,42],[48,31,44,43,"result"],[48,37,44,49],[48,38,44,50,"type"],[48,42,44,54],[48,46,44,58,"envelope"],[48,54,44,66],[48,55,44,67,"result"],[48,61,44,73],[48,62,44,74,"type"],[48,66,44,78],[48,71,44,83],[48,77,44,89],[48,82,44,94,"envelope"],[48,90,44,102],[48,91,44,103,"result"],[48,97,44,109],[48,98,44,110,"id"],[48,100,44,112],[48,102,44,114],[49,18,45,32],[50,18,46,32,"lastEventId"],[50,29,46,43],[50,32,46,46,"envelope"],[50,40,46,54],[50,41,46,55,"result"],[50,47,46,61],[50,48,46,62,"id"],[50,50,46,64],[51,16,47,28],[52,16,48,28,"observer"],[52,24,48,36],[52,25,48,37,"next"],[52,29,48,41],[52,30,48,42,"envelope"],[52,38,48,50],[52,39,48,51],[53,14,49,24],[53,15,49,25],[54,14,50,24,"complete"],[54,22,50,32,"complete"],[54,23,50,32],[54,25,50,36],[55,16,51,28,"observer"],[55,24,51,36],[55,25,51,37,"complete"],[55,33,51,45],[55,34,51,46],[55,35,51,47],[56,14,52,24],[57,12,53,20],[57,13,53,21],[57,14,53,22],[58,10,54,16],[59,10,55,16],[59,17,55,23],[59,23,55,27],[60,12,56,20,"next$"],[60,17,56,25],[60,18,56,26,"unsubscribe"],[60,29,56,37],[60,30,56,38],[60,31,56,39],[61,10,57,16],[61,11,57,17],[62,8,58,12],[62,9,58,13],[62,10,58,14],[63,6,59,8],[63,7,59,9],[64,4,60,4],[64,5,60,5],[65,2,61,0],[66,0,61,1],[66,3]],"functionMap":{"names":["<global>","retryLink","<anonymous>","observable$argument_0","opWithLastEventId","attempt","callOpts.next.subscribe$argument_0.error","callOpts.next.subscribe$argument_0.next","callOpts.next.subscribe$argument_0.complete"],"mappings":"AAA;ICM;WCE;8BCI;gBCI;iBDS;gBEC;wBCG;yBDW;wBEC;yBFO;wBGC;yBHE;iBFE;uBDC;iBCE;aDC;KDE;CDC"}},"type":"js/module"}]}